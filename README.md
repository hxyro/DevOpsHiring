## Infrastructure Setup
To set up the infrastructure, navigate to the `terraform` directory and create a `.env` file. The Terraform provider uses PostgreSQL as a backend to store Terraform state files.

Since Terraform does not natively support `.env` files, you have two options:

Manual Sourcing: Use `source .env` before executing Terraform commands.
Using make: The provided Makefile automates this process. Refer to the Makefile for details.

Follow these steps to initialize Terraform:

```
cd terraform
cp .env.example .env
# Update .env with your specific environment variables
make init
```

### Initial Configuration Application
Before applying the initial configuration, you must temporarily comment out the cluster_resources module. This is necessary because the Kubernetes provider in Terraform does not support the depends_on attribute.

```
# module "cluster_resources" {
#   source = "./modules/cluster_resources"
#   host = module.cluster.kubeconfig.0.host
#   cluster_ca_certificate = module.cluster.kubeconfig.0.cluster_ca_certificate
#   cluster_token = module.cluster.kubeconfig.0.token
# }
```

Once you have commented out the module, apply the configuration:

```
make apply
```

### Kubernetes Package Installation
After the initial apply, install the necessary Kubernetes packages, which include:

* cert-manager
* ingress-nginx
* metrics-server

To install these packages, uncomment the cluster_resources module in your Terraform configuration and apply the changes again:

```
make apply
```

### Manual Cluster Issuer Installation

Finally, manually install the cluster issuer using the kubeconfig generated by Terraform:

```
kubectl apply -f terraform/modules/cluster_resources/modules/extras/cluster-issuer.yaml
```

---

## Docker Images & Local Development

This project includes two Dockerfiles: Dockerfile for production environments and Dockerfile.dev for local development. This separation ensures that development-specific changes are not inadvertently included in production builds.

To set up for local development, ensure Docker is installed and then run the following command:

```
docker compose up
```

The application will be accessible at `localhost:5000`
| NOTE: The Dockerfile.jenkins file should be ignored.

---

## Kubernetes Configuration

Kubernetes configuration files are managed using Kustomize. The directory structure is as follows:

```
kustomize
├── config
│   └── configmap.yaml
├── deployments
│   └── flask-backend.yaml
├── ingress
│   └── ingress.yaml
├── kustomization.yaml
└── service
    └── flask-backend.yaml
```

---

## Project Considerations

The following tool versions were used during the creation of this project:

* Terraform: v1.5.7
* Kustomize: v5.5.0
* Python: 3.10.13